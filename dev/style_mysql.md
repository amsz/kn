# MySQL 编码规范

## 命名规范

##### 👍 强制类

* 库名、表名、字段名使用小写字母，并采用下划线分割，例如 `user_type` 、 `parent_id`
* 使用英文单词的单数形式
* 和时间相关的字段以_at 结尾，例如 `create_at` 、 `login_at`
* 和人相关的字段以_by 结尾，例如 `create_by` 、 `apply_by`
* 字段必须填写描述信息

##### 👏 建议类 

* 表名加前缀，一般用系统或模块的名称缩写，例如 `sys_user`
* 临时库、表以tmp为前缀并以日期为后缀，例如 `tmp_test01_20130704`
* 备份库、表以bak为前缀并以日期为后缀，例如 `bak_test01_20130704`
* 表名不可以太长，不要超过3个英文单词长度（22个字母）


## 设计规范

#### 字段类型

整型：

- tinyint（1Byte）最大255
- smallint（2Byte）最大 3 万多，unsigned 最大 6 万多
- mediumint（3Byte）最大 800 多万，unsigned 最大 1600 多万
- int（4Byte）最大 21 亿多，unsigned 最大 42 亿多
- bigint（8Byte）

浮点型：

* 使用 DECIMAL(M,D) 而不是 DECIMAL
* 建议乘以固定倍数转换成整数存储，可以节省存储空间，且不会带来任何附加维护成本

字符型：

* text（2Byte）最大 65,535
* MEDIUMTEXT 最大长度为16,777,215。
* LONGTEXT 最大长度为4,294,967,295

时间型：

* 如果时间字段只需要精确到天，用date类型
* 精确（年月日时分秒）的时间字段，使用datetime、timestamp

##### 👏 建议类

- 根据第三范式（3NF）来设计数据库，再根据效率做必要反范式设计
- 避免使用NULL字段(很难查询优化、索引需要额外空间、复合索引无效)，建议用 0、空串、当前时间等代替
- 自增序列类型的字段只能使用unsigned int，防止超出违反（比如用户大批量导入数据）
- 尽量不要用text，varchar的性能会比text高很多
- 禁用blob

#### 主键

👍 [强制] 为每一张表设计一个与业务无关的主键字段，什么时候都不能改，根据数据量可以用自增 INT 主键或者其他类型的主键。

典型错误例子：使用学号作为学生表的主键；使用用户名作为用户表的主键。

比如你用 INT 做文章的id，但是如果在未来某一天文章数超过了无符号整形的最大值，你将没法将主键修改成bigint。或者为了给用户起一个唯一id用了自增主键，但是如果未来有其他的项目用户要合并进来，他也是这么做的。这时候为了区分不同的项目可能要在这个用户id前加一个前缀，这时候也没法修改主键的值。

👏  varchar 主键不建议使用 UUID，原因：

* InnoDB 采用聚合索引（按照主键的顺序来排放数据)，而 UUID 是无序的，会造成插入时的排序和数据移动，带来很大的I/O，会影响效率。
* 效率不高，数据在索引的时候效率会随着体积的增加而降低。
* UUID 主键显得冗长，不够友好。
* 存储一个UUID要花费更多的空间。

制定合适的主键生成策略，保证主键的唯一性，有序性和简短。自增 id 作为主键（或者是改用有特定顺序的键），UUID 作为唯一键。

#### 索引

- 改善查询、减慢更新
- 覆盖记录条数过多不适合建索引，例如 "性别"
- 最好的备选数据列是出现在WHERE子句、JOIN 子句、ORDER BY 或 GROUP BY 子句中的列



##### 👍 强制类

* 字符字段必须使用前缀索引



##### 👏 建议类

- 添加索引时，建议索引名称以 `idx_` 为前缀
- 字段事实上是与其它表的关键字相关联而未设计为外键引用，需建索引
- 字段与其它表的字段相关联，需建索引
- 字段需做模糊查询之外的条件查询，需建索引
- 主关键字允许建立簇索引外，其它字段所建索引必须为非簇索引
- 不用联合主键，改为做唯一索引

## 使用规范

##### 👍 强制类

* 不用 `select *
* 禁止在数据库中存储图片、文件等大数据



##### 👏 建议类

*  用 IN 代替 OR

  ```sql
  /* good */
  select id from t where phone in ('159', '136');

  /* bad */
  select id from t where phone='159' or phone='136';
  ```

* 用 UNION 代替 OR

  ```sql
  /* good */
  select id from t where phone='159'
  union
  select id from t where name='jonh'

  /* bad */
  select id from t where phone = '159' or name = 'john';
  ```

  ​

- SQL 语句中 IN 包含的值不应过多，控制在 200 个以内，最多不得超过300
- 平衡范式与冗余，效率优先，往往牺牲范式
- 不要使用外键 ，应由程序保证约束
- 合理分离冷热数据，将大字段、访问频率低的字段拆分到单独的表中存储
- 控制单表数据量，int型不超过1000w，含char则不超过500w
- 单库表数量在300以内，最多不要超过500个表
- 单表字段数不要太多，字段数建议在20以内，最多不要大于50个
- 获取大量数据时建议分批次获取数据，每次获取数据少于 2000 条，结果集应小于 1M
- 当只要一行数据时使用 LIMIT 1